function preload(){document.getElementById("sketch-holder");img=loadImage("selfiebw.png")}function setup(){var e=document.getElementById("sketch-holder").offsetWidth;canvas=createCanvas(e,.8633333333333333*e),canvasScale=e/600,smooth(),textAlign(CENTER),img.loadPixels(),edgeImg=createImage(img.width,img.height,RGB),edgeImg.loadPixels();for(var t=[[-1,0,1],[-2,0,2],[-1,0,1]],i=[[-1,-2,-1],[0,0,0],[1,2,1]],r=1;r<img.height-1;r++)for(var s=1;s<img.width-1;s++){for(var l=0,n=0,a=0,o=-1;1>=o;o++)for(var d=-1;1>=d;d++){var h=4*((r+o)*img.width+(s+d)),c=img.pixels[h];l+=t[o+1][d+1]*c,n+=i[o+1][d+1]*c}a=sqrt(sq(l)+sq(n)),edgeImg.pixels[4*(r*img.width+s)]=a,edgeImg.pixels[4*(r*img.width+s)+1]=a,edgeImg.pixels[4*(r*img.width+s)+2]=a,edgeImg.pixels[4*(r*img.width+s)+3]=255}offset=0,edgeImg.updatePixels(),sketchedTriangles=[],findPoints(),initTris();var g=document.getElementById("placeholderpic");g.parentNode.removeChild(g),canvas.parent("sketch-holder")}function drawTri(e,t,i,r,s){var l=255-r[0];map(l,0,255,.6,.9),lerp(12,242,r[0]/255),lerp(97,0,r[0]/255),lerp(232,255,r[0]/255);if(r[0]>0){var n=createVector(e[0],e[1]),a=createVector(t[0],t[1]),o=createVector(i[0],i[1]),d=createVector(e[0]+t[0]/2,(e[1],t[1]/2)),h=d.dist(o);l=spacingValue/h*(255-r[0]);min(e[0],t[0],i[0]),min(e[1],t[1],i[1]),max(e[0],t[0],i[0]),max(e[1],t[1],i[1]);return new SketchedTriangle([n,a,o],r[0])}}function sketchLine(e,t,i,r){var s=createVector(e.x,e.y);s.sub(t),s.normalize(),s.rotate(HALF_PI),r.noFill(),r.beginShape();for(var l=0;1>=l;l+=.2){var n=lerp(e.x,t.x,l)+(2*noise(i)-1)*s.x*3,a=lerp(e.y,t.y,l)+(2*noise(i)-1)*s.y*3;r.vertex(n,a),i+=.2}r.endShape(),r.beginShape();for(var l=0;1>=l;l+=.2){var n=lerp(e.x,t.x,l)+(2*noise(i)-1)*s.x*3,a=lerp(e.y,t.y,l)+(2*noise(i)-1)*s.y*3;r.vertex(n,a),i+=.2}return r.endShape(),i}function changeVerts(){this.VERTS=vert,findPoints(),initTris()}function inside(e,t){for(var i=e[0],r=e[1],s=!1,l=0,n=t.length-1;l<t.length;n=l++){var a=t[l][0],o=t[l][1],d=t[n][0],h=t[n][1],c=o>r!=h>r&&(d-a)*(r-o)/(h-o)+a>i;c&&(s=!s)}return s}function inside(e,t){for(var i=e[0],r=e[1],s=!1,l=0,n=t.length-1;l<t.length;n=l++){var a=t[l][0],o=t[l][1],d=t[n][0],h=t[n][1],c=o>r!=h>r&&(d-a)*(r-o)/(h-o)+a>i;c&&(s=!s)}return s}function findPoints(){for(edgeImg.loadPixels(),triVertsList=[];triVertsList.length<vert;){var e=floor(random(edgeImg.width)),t=floor(random(edgeImg.height)),i=edgeImg.pixels[4*(t*edgeImg.width+e)];i>35&&triVertsList.push([e,t])}triangles=Delaunay.triangulate(triVertsList),createHull()}function createHull(){hullList=hull(triVertsList.slice(0),hullValue),cullTris()}function initTris(){var e;for(e=0;e<points.length;e++);for(sketchedTriangles=[],e=0;e<culledTriList.length;e+=3){var t=[];t.push(findShadow(e)),t.push(0);var i=[];i=findMidpoint(e),sketchedTriangles.push(drawTri(triVertsList[culledTriList[e]],triVertsList[culledTriList[e+1]],triVertsList[culledTriList[e+2]],t,e)),noiseoffset+=.008}for(e=0;e<hull.length-1;e++);}function drawImage(){for(var e=0;e<sketchedTriangles.length;e++){var t=sketchedTriangles[e];t instanceof SketchedTriangle&&(t.update(),t.draw())}}function cullTris(){culledTriList=new Array;for(var e=0;e<triangles.length;e+=3){var t=(triVertsList[triangles[e]][0]+triVertsList[triangles[e+1]][0]+triVertsList[triangles[e+2]][0])/3,i=(triVertsList[triangles[e]][1]+triVertsList[triangles[e+1]][1]+triVertsList[triangles[e+2]][1])/3,r=[t,i];inside(r,hullList)&&(culledTriList.push(triangles[e]),culledTriList.push(triangles[e+1]),culledTriList.push(triangles[e+2]))}}function findShadow(e){var t=floor((triVertsList[culledTriList[e]][0]+triVertsList[culledTriList[e+1]][0]+triVertsList[culledTriList[e+2]][0])/3),i=floor((triVertsList[culledTriList[e]][1]+triVertsList[culledTriList[e+1]][1]+triVertsList[culledTriList[e+2]][1])/3),r=img.pixels[4*(i*img.width+t)],s=img.pixels[4*(i*img.width+t)+3],l=(255-r)/256*(s/256)*256;return l}function findMidpoint(e){var t=(triVertsList[culledTriList[e]][0]+triVertsList[culledTriList[e+1]][0]+triVertsList[culledTriList[e+2]][0])/3,i=(triVertsList[culledTriList[e]][1]+triVertsList[culledTriList[e+1]][1]+triVertsList[culledTriList[e+2]][1])/3;return t=floor(t),i=floor(i),[t,i]}function draw(){clear(),push(),translate(offset,0),scale(canvasScale),drawImage(),stroke(0),pop()}function mousePressed(){saveFrames("out","png",1,25,function(e){print(e)})}var ALPHA=10,img,points=new Array,edgeImg,triVertsList=new Array,triangles,sketchedTriangles,culledTriList,offset,hullList,vert=800,lineThickness=1,spacingValue=.2,hullValue=107,percentageToDraw=.001,noiseThreshold=1,noiseoffset=0,canvasScale,canvas;window.onresize=function(){var e=document.getElementById("sketch-holder").offsetWidth;canvas.size(e,.8633333333333333*e),canvasScale=e/600,offset=0};var SketchedTriangle=function(e,t){this.randomDir=p5.Vector.random2D(),this.verts=e,this.centerX=(e[0].x+e[1].x+e[2].x)/3,this.centerY=(e[0].y+e[1].y+e[2].y)/3,this.transparency=t};SketchedTriangle.prototype.update=function(){3.6*frameCount;this.distance=dist(mouseX,mouseY,this.centerX*canvasScale,this.centerY*canvasScale),this.distance>400?(this.fallOff=0,this.multiply=0):(this.fallOff=1/(.2+1.807*this.distance+this.distance*this.distance*.026),this.multiply=2103*this.fallOff,this.multiply=Math.min(this.multiply,600))},SketchedTriangle.prototype.draw=function(){noStroke(),fill(color(8,this.transparency)),beginShape(),vertex(this.verts[0].x+this.randomDir.x*this.multiply,this.verts[0].y+this.randomDir.y*this.multiply),vertex(this.verts[1].x+this.randomDir.x*this.multiply,this.verts[1].y+this.randomDir.y*this.multiply),vertex(this.verts[2].x+this.randomDir.x*this.multiply,this.verts[2].y+this.randomDir.y*this.multiply),endShape()};